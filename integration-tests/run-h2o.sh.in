#!/usr/bin/env bash

resources=H2O
atrip="../bench/atrip"
outfile=out

cmd=(
  mpirun # -np 4

  ${atrip}

  --no 4
  --nv 36

  # --max-iterations 50

  --ei    ./${resources}/EigenEnergies.components.h.elements
  --ea    ./${resources}/EigenEnergies.components.p.elements
  --Tpphh ./${resources}/Amplitudes.components.pphh.elements
  --Tph   ./${resources}/Amplitudes.components.ph.elements
  --Vpphh ./${resources}/CoulombIntegrals.components.pphh.elements
  --Vhhhp ./${resources}/CoulombIntegrals.components.hhhp.elements
  --Vppph ./${resources}/CoulombIntegrals.components.ppph.elements
  # J for ct
  --Jhhhp ./${resources}/ctIntermediate.components.hphh.elements
  --Jppph ./${resources}/ctIntermediate.components.ppph.elements
  --cT

  # dist can also be naive
  --nocheckpoint
  --dist group
  # --dist naive

  # --mod 10
   -% 1
)

set -x
date
"${cmd[@]}" | tee $outfile
date
set +x

printf '\5$n'

{
  echo Name Correct Ours Diff | sed "p; s/[^ ]/-/g"
  {
    paste - <(grep '^Energy' $outfile | awk -F: '{print $2}') <<EOF
(T) -0.005239608018571
(cT) -0.0048452100
EOF
  } | awk '{print $1, $2, $3, $2-$3}'
} | column -t
